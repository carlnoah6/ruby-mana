<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ruby-mana üîÆ ‚Äî Embed LLM as Native Ruby</title>
  <meta name="description" content="Natural language strings that read/write Ruby variables, call functions, and control flow. LLM as a first-class language construct.">
  <meta property="og:title" content="ruby-mana ‚Äî Embed LLM as Native Ruby">
  <meta property="og:description" content="Not an API wrapper. A language construct that weaves LLM into Ruby code.">
  <style>
    :root { --bg:#0d1117; --sf:#161b22; --bd:#30363d; --tx:#e6edf3; --dim:#8b949e; --ac:#a371f7; --ac2:#f778ba; --ac3:#79c0ff; --gr:#3fb950; --or:#d29922; }
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif;background:var(--bg);color:var(--tx);line-height:1.6}
    a{color:var(--ac3);text-decoration:none} a:hover{text-decoration:underline}
    code,pre{font-family:'SF Mono','Fira Code',monospace}
    .c{max-width:880px;margin:0 auto;padding:0 24px}
    nav{position:sticky;top:0;z-index:100;background:rgba(13,17,23,.85);backdrop-filter:blur(12px);border-bottom:1px solid var(--bd);padding:12px 0}
    nav .c{display:flex;align-items:center;justify-content:space-between}
    nav .logo{font-weight:700;font-size:1.1rem} nav .logo .m{color:var(--ac)}
    nav .lk{display:flex;gap:20px;font-size:.9rem} nav .lk a{color:var(--dim)} nav .lk a:hover{color:var(--tx);text-decoration:none}
    .hero{text-align:center;padding:100px 0 70px;position:relative}
    .hero::before{content:'';position:absolute;top:-200px;left:50%;transform:translateX(-50%);width:700px;height:700px;background:radial-gradient(circle,rgba(163,113,247,.12) 0%,transparent 70%);pointer-events:none}
    .hero h1{font-size:3.5rem;font-weight:800;letter-spacing:-.03em;margin-bottom:16px} .hero h1 .m{color:var(--ac)}
    .hero .tl{font-size:1.25rem;color:var(--dim);max-width:520px;margin:0 auto 12px}
    .hero .sub{font-size:.95rem;color:var(--dim);margin-bottom:40px} .hero .sub em{color:var(--ac2);font-style:normal}
    .badges{display:flex;gap:8px;justify-content:center;margin-bottom:36px}
    .badge{padding:4px 12px;border-radius:20px;font-size:.8rem;border:1px solid var(--bd);color:var(--dim)}
    pre{background:var(--sf);border:1px solid var(--bd);border-radius:10px;padding:20px 24px;overflow-x:auto;font-size:.88rem;line-height:1.7}
    .hero-code{display:inline-block;max-width:620px;width:100%;text-align:left}
    .kw{color:var(--ac2)} .str{color:#a5d6ff} .ms{color:var(--gr);font-weight:500} .cmt{color:var(--dim)} .num{color:var(--or)} .fn{color:#d2a8ff}
    section{padding:60px 0} section h2{font-size:2rem;font-weight:700;margin-bottom:12px;letter-spacing:-.02em}
    .lead{color:var(--dim);font-size:1.05rem;margin-bottom:32px;max-width:600px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:24px}
    .card{background:var(--sf);border:1px solid var(--bd);border-radius:10px;padding:20px 24px}
    .card h3{font-size:1rem;margin-bottom:6px} .card p{font-size:.88rem;color:var(--dim)}
    .card code{color:var(--gr);font-size:.85rem}
    .cmp>div{background:var(--sf);border:2px solid var(--bd);border-radius:10px;padding:20px 24px}
    .cmp>div h3{font-size:.95rem;margin-bottom:12px;color:var(--dim)}
    .cmp>div:last-child{border-color:var(--ac)} .cmp>div:last-child h3{color:var(--ac)}
    .ex{margin-top:32px} .ex h3{font-size:1.15rem;margin-bottom:12px} .ex p{font-size:.9rem;color:var(--dim);margin-bottom:12px}
    .steps{margin-top:24px} .step{display:flex;gap:16px;padding:16px 0;border-bottom:1px solid var(--bd)} .step:last-child{border-bottom:none}
    .sn{flex-shrink:0;width:32px;height:32px;border-radius:50%;background:var(--ac);color:var(--bg);font-weight:700;display:flex;align-items:center;justify-content:center;font-size:.85rem}
    .st{font-size:.92rem} .st strong{color:var(--tx)}
    .ib{background:var(--sf);border:1px solid var(--bd);border-radius:10px;padding:16px 24px;display:inline-block;font-size:1rem;margin-bottom:12px}
    .ib .d{color:var(--dim);user-select:none}
    footer{border-top:1px solid var(--bd);padding:40px 0;text-align:center;color:var(--dim);font-size:.85rem}
    footer a{color:var(--dim)} footer a:hover{color:var(--tx)}
    /* Carousel */
    .carousel{position:relative;width:100%;max-width:620px;display:inline-block;text-align:left}
    .carousel .slide{display:none;animation:fadeIn .4s ease}
    .carousel .slide.active{display:block}
    @keyframes fadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}
    .carousel-dots{display:flex;justify-content:center;gap:8px;margin-top:16px}
    .carousel-dots .dot{width:8px;height:8px;border-radius:50%;background:var(--bd);cursor:pointer;transition:background .2s}
    .carousel-dots .dot.active{background:var(--ac)}
    .carousel pre{margin:0}
    /* Install hero */
    .install-hero{margin-top:32px;margin-bottom:8px}
    .install-hero code{font-size:1.05rem;color:var(--gr)}
    .install-hero .d{color:var(--dim);user-select:none}

    .grid-3{grid-template-columns:1fr 1fr 1fr}

    /* Mobile */
    @media(max-width:768px){
      .c{padding:0 16px}
      nav .lk{gap:12px;font-size:.8rem}
      .hero{padding:60px 0 40px}
      .hero h1{font-size:2.4rem}
      .hero .tl{font-size:1.05rem}
      .hero .sub{font-size:.85rem;margin-bottom:24px}
      .badges{flex-wrap:wrap}
      pre{padding:14px 16px;font-size:.78rem;line-height:1.6;-webkit-overflow-scrolling:touch}
      .carousel{max-width:100%}
      section{padding:40px 0}
      section h2{font-size:1.5rem}
      .lead{font-size:.95rem}
      .grid,.grid-3,.cmp{grid-template-columns:1fr}
      .card{padding:16px 18px}
      .card h3{font-size:.95rem}
      .card p{font-size:.82rem}
      .cmp>div{padding:16px 18px}
      .ex h3{font-size:1.05rem}
      .step{gap:12px;padding:12px 0}
      .sn{width:28px;height:28px;font-size:.8rem}
      .st{font-size:.85rem}
      .install-hero code{font-size:.9rem}
      footer{padding:30px 0}
    }
    @media(max-width:480px){
      nav .c{flex-direction:column;gap:8px}
      nav .lk{justify-content:center;flex-wrap:wrap;gap:10px}
      .hero h1{font-size:1.9rem}
      .hero .tl{font-size:.95rem}
      pre{padding:12px 12px;font-size:.72rem;border-radius:8px}
      .badges .badge{font-size:.7rem;padding:3px 8px}
    }
  </style>
</head>
<body>

<nav>
  <div class="c">
    <div class="logo">ruby-<span class="m">mana</span> üîÆ</div>
    <div class="lk">
      <a href="#features">Features</a>
      <a href="#examples">Examples</a>
      <a href="#polyglot">Polyglot</a>
      <a href="#how">How it works</a>
      <a href="https://github.com/carlnoah6/ruby-mana">GitHub</a>
      <a href="https://rubygems.org/gems/ruby-mana">RubyGems</a>
    </div>
  </div>
</nav>

<div class="c">

<!-- Hero -->
<div class="hero">
  <h1>ruby-<span class="m">mana</span> üîÆ</h1>
  <p class="tl">Embed LLM as native Ruby. Write natural language, it just runs.</p>
  <p class="sub"><em>Not an API wrapper.</em> A language construct that weaves LLM into your code.</p>
  <div class="badges">
    <span class="badge" style="border-color:var(--gr);color:var(--gr)">v0.5.0</span>
    <span class="badge">Ruby 3.3+</span>
    <span class="badge">Multi-LLM</span>
    <span class="badge">Polyglot</span>
    <span class="badge">4 Engines</span>
    <span class="badge">MIT License</span>
  </div>

  <div class="carousel" id="heroCarousel">
    <div class="slide active">
<pre><span class="cmt"># Multilingual semantic computation</span>
numbers = [<span class="num">1</span>, <span class="str">"2"</span>, <span class="str">"three"</span>, <span class="str">"cuatro"</span>, <span class="str">"‰∫î"</span>]
<span class="ms">~"compute the semantic average of &lt;numbers&gt; and store in &lt;result&gt;"</span>
puts result  <span class="cmt"># =&gt; 3.0</span></pre>
    </div>
    <div class="slide">
<pre><span class="cmt"># LLM reads and writes Ruby objects directly</span>
email.subject = <span class="str">"URGENT: Server down"</span>
<span class="ms">~"read &lt;email&gt; subject, set its category and priority"</span>
email.category  <span class="cmt"># =&gt; "infrastructure"</span></pre>
    </div>
    <div class="slide">
<pre><span class="cmt"># Define tools the LLM can call</span>
Mana.define_effect <span class="str">:query_db</span> <span class="kw">do</span> |sql:|
  DB.execute(sql)
<span class="kw">end</span>
<span class="ms">~"find recent orders using query_db, store in &lt;orders&gt;"</span></pre>
    </div>
    <div class="slide">
<pre><span class="cmt"># LLM writes the code, Ruby runs it forever</span>
<span class="kw">mana def</span> <span class="fn">fizzbuzz</span>(n)
  <span class="ms">~"return FizzBuzz array from 1 to n"</span>
<span class="kw">end</span>
fizzbuzz(<span class="num">15</span>)  <span class="cmt"># generated once ‚Üí cached ‚Üí pure Ruby</span></pre>
    </div>
    <div class="slide">
<pre><span class="cmt"># LLM calls your functions automatically</span>
<span class="kw">def</span> <span class="fn">fetch_price</span>(symbol)
  { <span class="str">"AAPL"</span> =&gt; <span class="num">189.5</span>, <span class="str">"TSLA"</span> =&gt; <span class="num">248.9</span> }[symbol]
<span class="kw">end</span>
<span class="ms">~"call fetch_price for each in &lt;portfolio&gt;, sum into &lt;total&gt;"</span></pre>
    </div>
    <div class="slide">
<pre><span class="cmt"># Memory is automatic ‚Äî no session blocks needed</span>
<span class="ms">~"remember: user prefers concise style"</span>
<span class="ms">~"translate &lt;text&gt;"</span>          <span class="cmt"># remembers the preference</span>
<span class="ms">~"translate &lt;text2&gt;"</span>         <span class="cmt"># still remembers</span>
Mana.memory.long_term       <span class="cmt"># =&gt; persists across runs</span></pre>
    </div>
    <div class="slide">
<pre><span class="cmt"># Nested prompts ‚Äî LLM calling LLM</span>
lint = ->(<span class="fn">code</span>) { <span class="ms">~"check #{code} for style issues, store in &lt;issues&gt;"</span> }

<span class="ms">~"review &lt;codebase&gt;, call lint for each file, store in &lt;report&gt;"</span>
puts report  <span class="cmt"># each nested call gets its own context</span></pre>
    </div>
    <div class="slide">
<pre><span class="cmt"># Test mode ‚Äî no API calls needed</span>
<span class="kw">require</span> <span class="str">"mana/test"</span>

mock_prompt <span class="str">"analyze"</span>, bugs: [<span class="str">"XSS"</span>], score: <span class="num">8.5</span>
mock_prompt(<span class="str">/translate/</span>) { |p| { output: <span class="str">"hola"</span> } }
<span class="cmt"># ~"..." calls match stubs, never hit the API</span></pre>
    </div>
    <div class="slide">
<pre><span class="cmt"># Multi-LLM ‚Äî Anthropic, OpenAI, Ollama, and more</span>
Mana.configure <span class="kw">do</span> |c|
  c.api_key = ENV[<span class="str">"OPENAI_API_KEY"</span>]
  c.base_url = <span class="str">"https://api.openai.com"</span>
  c.model = <span class="str">"gpt-4o"</span>
<span class="kw">end</span>
<span class="cmt"># auto-detects backend from model name</span></pre>
    </div>
    <div class="slide">
<pre><span class="cmt"># One operator, any language ‚Äî auto-detected</span>
data = [<span class="num">1</span>, <span class="num">2</span>, <span class="num">3</span>, <span class="num">4</span>, <span class="num">5</span>]
<span class="ms">~"const evens = data.filter(n => n % 2 === 0)"</span>  <span class="cmt"># JS</span>
<span class="ms">~"mean = statistics.mean(data)"</span>                 <span class="cmt"># Python</span>
<span class="ms">~"analyze &lt;data&gt;, store in &lt;result&gt;"</span>            <span class="cmt"># LLM</span></pre>
    </div>
    <div class="carousel-dots" id="carouselDots"></div>
  </div>

  <div class="install-hero">
    <code><span class="d">$ </span>gem install ruby-mana</code>
  </div>
  <p style="font-size:.85rem;color:var(--dim)">or <code style="color:var(--dim)">gem "ruby-mana"</code> in your Gemfile</p>
</div>

<!-- What makes it different -->
<section>
  <h2>What makes it different</h2>
  <p class="lead">Mana turns LLM into a Ruby co-processor. Your natural language strings can read and write live Ruby state.</p>
  <div class="grid cmp">
    <div>
      <h3>Traditional LLM wrapper</h3>
<pre style="border:none;margin:0;background:none;">client = LLM::Client.new
response = client.chat(
  <span class="str">"Classify: #{email.subject}"</span>
)
data = JSON.parse(response)
email.category = data[<span class="str">"category"</span>]
email.priority = data[<span class="str">"priority"</span>]</pre>
    </div>
    <div>
      <h3>ruby-mana</h3>
<pre style="border:none;margin:0;background:none;"><span class="ms">~"read &lt;email&gt; subject and body, set its category and priority"</span>

<span class="cmt"># That's it. email.category and email.priority are set.</span></pre>
    </div>
  </div>
</section>

<!-- Features -->
<section id="features">
  <h2>Features</h2>
  <div class="grid">
    <div class="card">
      <h3>üîÆ <code>~"..."</code> syntax</h3>
      <p>One character turns any string into an LLM prompt that operates on live Ruby state. Variables, objects, functions ‚Äî all accessible.</p>
    </div>
    <div class="card">
      <h3>üìñ Bidirectional binding</h3>
      <p>LLM reads your variables with <code>&lt;var&gt;</code>, writes back with <code>write_var</code>. No serialization, no parsing ‚Äî direct access to the Ruby binding.</p>
    </div>
    <div class="card">
      <h3>‚ö° Custom effects</h3>
      <p>Define your own tools with <code>Mana.define_effect</code>. Block params become the tool schema. LLM calls them like native functions.</p>
    </div>
    <div class="card">
      <h3>üß¨ LLM compiler</h3>
      <p><code>mana def</code> generates method implementations on first call, caches as real <code>.rb</code> files. Subsequent calls are pure Ruby ‚Äî zero API cost.</p>
    </div>
    <div class="card">
      <h3>üîç Source introspection</h3>
      <p>Prism AST parser auto-discovers your methods and their signatures. LLM knows what functions are available without you listing them.</p>
    </div>
    <div class="card">
      <h3>üõ°Ô∏è Effect system</h3>
      <p>Built on algebraic effects theory. 6 built-in effects (read/write var, read/write attr, call func, done) + unlimited custom effects.</p>
    </div>
    <div class="card">
      <h3>üß† Automatic memory</h3>
      <p>Short-term context shared across <code>~"..."</code> calls by default. Long-term memory persists to disk. <code>Mana.incognito</code> for clean-slate mode.</p>
    </div>
    <div class="card">
      <h3>ü™Ü Nested prompts</h3>
      <p>Functions called by LLM can themselves use <code>~"..."</code>. Each nested call gets its own conversation context while sharing long-term memory.</p>
    </div>
    <div class="card">
      <h3>üß™ Test mode</h3>
      <p>Stub LLM responses with <code>mock_prompt</code>. String or regex matching, block-based dynamic values. Zero API calls in tests.</p>
    </div>
    <div class="card">
      <h3>üîå Multi-LLM backends</h3>
      <p>Anthropic and OpenAI-compatible APIs out of the box. Works with Ollama, DeepSeek, Groq, and more. Auto-detects backend from model name.</p>
    </div>
    <div class="card">
      <h3>üåê Polyglot ‚Äî 4 engines</h3>
      <p>Same <code>~"..."</code> runs JavaScript (V8), Python, Ruby eval, or LLM. Auto-detected from syntax. Bidirectional calling, RemoteRef proxies, and automatic GC across all engines.</p>
    </div>
  </div>
</section>

<!-- Examples -->
<section id="examples">
  <h2>Examples</h2>

  <div class="ex">
    <h3>Variables ‚Äî read and write</h3>
    <p>Use <code>&lt;var&gt;</code> to reference variables. Existing ones are read, new ones are created.</p>
<pre>name = <span class="str">"Alice"</span>
scores = [<span class="num">85</span>, <span class="num">92</span>, <span class="num">78</span>, <span class="num">95</span>, <span class="num">88</span>]

<span class="ms">~"analyze &lt;scores&gt; for &lt;name&gt;, store mean in &lt;average&gt; and a comment in &lt;comment&gt;"</span>

puts average  <span class="cmt"># =&gt; 87.6</span>
puts comment  <span class="cmt"># =&gt; "Excellent and consistent performance"</span></pre>
  </div>

  <div class="ex">
    <h3>Function calling</h3>
    <p>LLM discovers and calls your Ruby methods automatically via source introspection.</p>
<pre><span class="kw">def</span> <span class="fn">fetch_price</span>(symbol)
  { <span class="str">"AAPL"</span> =&gt; <span class="num">189.5</span>, <span class="str">"GOOG"</span> =&gt; <span class="num">141.2</span>, <span class="str">"TSLA"</span> =&gt; <span class="num">248.9</span> }[symbol] || <span class="num">0</span>
<span class="kw">end</span>

portfolio = [<span class="str">"AAPL"</span>, <span class="str">"GOOG"</span>, <span class="str">"TSLA"</span>]
<span class="ms">~"call fetch_price for each in &lt;portfolio&gt;, store the sum in &lt;total&gt;"</span>
puts total  <span class="cmt"># =&gt; 579.6</span></pre>
  </div>

  <div class="ex">
    <h3>Custom effect handlers</h3>
    <p>Define your own tools. Block keyword params become the tool's input schema.</p>
<pre>Mana.define_effect <span class="str">:query_db</span>,
  description: <span class="str">"Execute a SQL query"</span> <span class="kw">do</span> |sql:|
    ActiveRecord::Base.connection.execute(sql).to_a
  <span class="kw">end</span>

<span class="ms">~"find the 5 most recent orders using query_db, store in &lt;orders&gt;"</span>
orders.each { |o| puts o[<span class="str">"id"</span>] }</pre>
  </div>

  <div class="ex">
    <h3>LLM-compiled methods</h3>
    <p>LLM writes the implementation once, caches it as a real <code>.rb</code> file. After that, pure Ruby.</p>
<pre><span class="kw">mana def</span> <span class="fn">fizzbuzz</span>(n)
  <span class="ms">~"return an array of FizzBuzz results from 1 to n"</span>
<span class="kw">end</span>

fizzbuzz(<span class="num">15</span>)  <span class="cmt"># first call ‚Üí LLM generates ‚Üí .mana_cache/fizzbuzz.rb</span>
fizzbuzz(<span class="num">20</span>)  <span class="cmt"># pure Ruby, zero API cost</span>

puts Mana.source(<span class="str">:fizzbuzz</span>)  <span class="cmt"># view the generated code</span></pre>
  </div>

  <div class="ex">
    <h3>Object manipulation</h3>
    <p>LLM reads and writes object attributes directly.</p>

  <div class="ex">
    <h3>Nested prompts</h3>
    <p>Functions called by LLM can contain <code>~"..."</code> prompts. Each nested call gets isolated context.</p>
<pre><span class="cmt"># Lambda style ‚Äî concise</span>
lint = ->(<span class="fn">code</span>) { <span class="ms">~"check #{code} for style issues, store in &lt;issues&gt;"</span> }
<span class="cmt"># Equivalent to:
# def lint(code)
#   ~"check #{code} for style issues, store in &lt;issues&gt;"
#   issues
# end</span>

<span class="ms">~"review &lt;codebase&gt;, call lint for each file, store report in &lt;report&gt;"</span>
puts report  <span class="cmt"># outer LLM only sees return values, context stays clean</span></pre>
  </div>

  <div class="ex">
    <h3>Memory ‚Äî automatic context</h3>
    <p>Consecutive calls share context by default. Use <code>remember</code> for persistent long-term memory.</p>
<pre><span class="cmt"># Memory is automatic ‚Äî no session blocks</span>
<span class="ms">~"remember: always use British English"</span>
<span class="ms">~"translate &lt;text&gt; to English"</span>   <span class="cmt"># uses British English</span>
<span class="ms">~"translate &lt;text2&gt; to English"</span>  <span class="cmt"># still remembers</span>

<span class="cmt"># Long-term memory persists across script runs</span>
Mana.memory                     <span class="cmt"># inspect memory state</span>
Mana.memory.forget(id: <span class="num">1</span>)      <span class="cmt"># remove a specific memory</span>

<span class="cmt"># Incognito mode ‚Äî clean slate</span>
Mana.incognito <span class="kw">do</span>
  <span class="ms">~"translate &lt;text3&gt;"</span>           <span class="cmt"># no memory loaded or saved</span>
<span class="kw">end</span></pre>
  </div>

  <div class="ex">
    <h3>Testing ‚Äî mock mode</h3>
    <p>Stub LLM responses by pattern. No API key or network needed in tests.</p>
<pre><span class="kw">require</span> <span class="str">"mana/test"</span>

RSpec.describe MyApp <span class="kw">do</span>
  include Mana::TestHelpers

  it <span class="str">"analyzes code"</span> <span class="kw">do</span>
    mock_prompt <span class="str">"analyze"</span>, bugs: [<span class="str">"XSS"</span>], score: <span class="num">8.5</span>

    result = MyApp.analyze(<span class="str">"input"</span>)
    expect(result[:bugs]).to include(<span class="str">"XSS"</span>)
  <span class="kw">end</span>
<span class="kw">end</span></pre>
  </div>

  <div class="ex">
    <h3>Object manipulation</h3>
    <p>LLM reads and writes object attributes directly.</p>
<pre><span class="kw">class</span> Email
  <span class="kw">attr_accessor</span> <span class="str">:subject</span>, <span class="str">:body</span>, <span class="str">:category</span>, <span class="str">:priority</span>
<span class="kw">end</span>

email = Email.new
email.subject = <span class="str">"URGENT: Server down"</span>
email.body = <span class="str">"Database connection pool exhausted..."</span>

<span class="ms">~"read &lt;email&gt; subject and body, set its category and priority"</span>
puts email.category  <span class="cmt"># =&gt; "infrastructure"</span>
puts email.priority  <span class="cmt"># =&gt; "critical"</span></pre>
  </div>
</section>

<!-- Polyglot -->
<section id="polyglot">
  <h2>One operator, four engines</h2>
  <p class="lead"><code>~"..."</code> auto-detects JavaScript, Python, Ruby, or natural language and routes to the right engine. Variables bridge automatically.</p>

  <div class="grid grid-3" style="margin-bottom:24px">
    <div class="card">
      <h3>üü® JavaScript (V8)</h3>
<pre style="border:none;margin:0;background:none;padding:0;font-size:.82rem">data = [<span class="num">1</span>, <span class="num">2</span>, <span class="num">3</span>, <span class="num">4</span>, <span class="num">5</span>]

<span class="ms">~"const evens = data.filter(
    n => n % 2 === 0
  )"</span>
puts evens
<span class="cmt"># => [2, 4]</span></pre>
    </div>
    <div class="card">
      <h3>üêç Python</h3>
<pre style="border:none;margin:0;background:none;padding:0;font-size:.82rem">data = [<span class="num">1</span>, <span class="num">2</span>, <span class="num">3</span>, <span class="num">4</span>, <span class="num">5</span>]

<span class="ms">~"evens = [n for n in data
    if n % 2 == 0]"</span>
puts evens
<span class="cmt"># => [2, 4]</span></pre>
    </div>
    <div class="card">
      <h3>ü§ñ Natural Language</h3>
<pre style="border:none;margin:0;background:none;padding:0;font-size:.82rem">data = [<span class="num">1</span>, <span class="num">2</span>, <span class="num">3</span>, <span class="num">4</span>, <span class="num">5</span>]

<span class="ms">~"find even numbers in
  &lt;data&gt;, store in &lt;evens&gt;"</span>
puts evens
<span class="cmt"># => [2, 4]</span></pre>
    </div>
  </div>

  <p style="color:var(--dim);font-size:.88rem;margin-bottom:32px">Detection uses token patterns from <code>data/lang-rules.yml</code>. Override with <code>Mana.engine = :javascript</code> or <code>Mana.with(:python) { ... }</code>. The fourth engine is <code>:ruby</code> ‚Äî <code>eval</code> in a sandboxed namespace.</p>

  <h3 style="font-size:1.3rem;margin-bottom:16px">üîÑ Bidirectional calling <span style="font-size:.8rem;color:var(--gr);font-weight:400">v0.5.0</span></h3>
  <p class="lead">Foreign engines can call Ruby methods, and Ruby can call into them. Not just variable bridging ‚Äî full function interop.</p>
  <div class="grid">
    <div class="card">
      <h3>JS ‚Üí Ruby</h3>
<pre style="border:none;margin:0;background:none;padding:0;font-size:.82rem"><span class="kw">def</span> <span class="fn">square</span>(n) = n ** <span class="num">2</span>

<span class="ms">~"const result = ruby.square(7)"</span>
puts result  <span class="cmt"># => 49</span>

<span class="cmt"># JS calls Ruby methods via the
# injected `ruby` bridge object</span></pre>
    </div>
    <div class="card">
      <h3>Python ‚Üí Ruby</h3>
<pre style="border:none;margin:0;background:none;padding:0;font-size:.82rem"><span class="kw">def</span> <span class="fn">greet</span>(name) = <span class="str">"Hello #{name}"</span>

<span class="ms">~"msg = ruby.greet('world')"</span>
puts msg  <span class="cmt"># => "Hello world"</span>

<span class="cmt"># Python calls Ruby via the same
# `ruby` bridge ‚Äî read/write/call</span></pre>
    </div>
  </div>

  <h3 style="font-size:1.3rem;margin-top:32px;margin-bottom:16px">üß¨ RemoteRef ‚Äî complex objects across engines <span style="font-size:.8rem;color:var(--gr);font-weight:400">v0.5.0</span></h3>
  <p class="lead">Complex Ruby objects are passed as proxies, not serialized. Method calls route back through the bridge transparently.</p>
<pre>user = User.new(<span class="str">"Alice"</span>, role: <span class="str">"admin"</span>)

<span class="cmt"># JS receives a proxy ‚Äî method calls route back to Ruby</span>
<span class="ms">~"const name = user.name()"</span>       <span class="cmt"># => "Alice" (calls Ruby)</span>
<span class="ms">~"const isAdmin = user.admin()"</span>   <span class="cmt"># => true   (calls Ruby)</span>

<span class="cmt"># Python too</span>
<span class="ms">~"role = user.role()"</span>             <span class="cmt"># => "admin" (calls Ruby)</span>

<span class="cmt"># Objects are tracked in ObjectRegistry with integer IDs.
# No serialization, no data loss ‚Äî the real object stays in Ruby.</span></pre>

  <h3 style="font-size:1.3rem;margin-top:32px;margin-bottom:16px">‚ôªÔ∏è Automatic GC ‚Äî no memory leaks <span style="font-size:.8rem;color:var(--gr);font-weight:400">v0.5.0</span></h3>
  <p class="lead">When a RemoteRef is garbage collected on either side, the registry entry is released automatically.</p>
  <div class="grid grid-3">
    <div class="card">
      <h3>Ruby side</h3>
      <p><code>ObjectSpace.define_finalizer</code> on RemoteRef releases the ObjectRegistry entry when GC runs.</p>
    </div>
    <div class="card">
      <h3>JS side</h3>
      <p><code>FinalizationRegistry</code> on the Proxy calls <code>ruby.__ref_release()</code> when the JS proxy is collected.</p>
    </div>
    <div class="card">
      <h3>Python side</h3>
      <p><code>weakref.ref</code> callback releases the registry entry when the Python proxy is collected.</p>
    </div>
  </div>
  <p style="color:var(--dim);font-size:.88rem;margin-top:16px">Plus <code>on_release</code> callbacks on ObjectRegistry for custom cleanup (close connections, flush buffers, etc.).</p>

  <h3 style="font-size:1.3rem;margin-top:32px;margin-bottom:16px">üè∑Ô∏è Engine capabilities <span style="font-size:.8rem;color:var(--gr);font-weight:400">v0.5.0</span></h3>
  <p style="color:var(--dim);font-size:.88rem;margin-bottom:16px">Each engine declares what it supports. Query at runtime to adapt your code.</p>
<pre>Mana.engine_for(<span class="str">:javascript</span>).capabilities
<span class="cmt"># => #&lt;Set: {:execute, :variables, :bidirectional, :remote_ref, :gc_release}&gt;</span>

Mana.engine_for(<span class="str">:llm</span>).capabilities
<span class="cmt"># => #&lt;Set: {:execute, :variables, :tool_calling, :memory}&gt;</span>

<span class="cmt"># Feature-gate your code</span>
<span class="kw">if</span> engine.supports?(<span class="str">:bidirectional</span>)
  <span class="ms">~"result = ruby.heavy_compute(data)"</span>
<span class="kw">else</span>
  <span class="ms">~"analyze &lt;data&gt;, store in &lt;result&gt;"</span>
<span class="kw">end</span></pre>
</section>

<!-- How it works -->
<section id="how">
  <h2>How it works</h2>
  <p class="lead">Mana uses Ruby's unary <code>~</code> operator to bridge natural language, JavaScript, Python, and Ruby code.</p>
  <div class="steps">
    <div class="step">
      <div class="sn">1</div>
      <div class="st"><strong>~"..." triggers String#~@</strong> ‚Äî captures the caller's Binding via <code>binding_of_caller</code></div>
    </div>
    <div class="step">
      <div class="sn">2</div>
      <div class="st"><strong>Detect language</strong> ‚Äî token patterns route to the right engine: JavaScript (V8), Python, Ruby eval, or LLM</div>
    </div>
    <div class="step">
      <div class="sn">3</div>
      <div class="st"><strong>Bridge variables</strong> ‚Äî simple types copy automatically; complex objects become RemoteRef proxies with method forwarding</div>
    </div>
    <div class="step">
      <div class="sn">4</div>
      <div class="st"><strong>Execute</strong> ‚Äî JS/Python run natively; LLM gets tools (6 built-in effects + custom). Bidirectional: foreign code can call Ruby back</div>
    </div>
    <div class="step">
      <div class="sn">5</div>
      <div class="st"><strong>Cleanup</strong> ‚Äî variables are set, objects modified. GC finalizers release RemoteRef entries automatically ‚Äî no leaks</div>
    </div>
  </div>
</section>

<!-- Install -->
<section>
  <h2>Install</h2>
  <div class="ib"><code><span class="d">$ </span>gem install ruby-mana</code></div>
  <p style="color:var(--dim);font-size:.9rem;margin-bottom:8px">Or in your Gemfile: <code>gem "ruby-mana"</code></p>
  <p style="color:var(--dim);font-size:.9rem;margin-bottom:8px">Requires Ruby 3.3+ and an API key (<code>ANTHROPIC_API_KEY</code> or <code>OPENAI_API_KEY</code>).</p>
  <p style="color:var(--dim);font-size:.9rem">For polyglot: <code>gem "mini_racer"</code> (JavaScript) and <code>gem "pycall"</code> (Python) are optional.</p>
</section>

<!-- Research -->
<section>
  <h2>Research</h2>
  <p class="lead">Mana is inspired by MIT's Nightjar project and the theory of algebraic effects and handlers.</p>
  <p style="color:var(--dim);font-size:.9rem;line-height:1.8">
    üìÑ <a href="https://arxiv.org/abs/2512.14805">Sharing State Between Prompts and Programs</a> ‚Äî the paper behind this approach<br>
    üêç <a href="https://github.com/psg-mit/nightjarpy">nightjarpy</a> ‚Äî MIT's Python implementation<br>
    üíé ruby-mana ‚Äî the Ruby implementation, with <code>~"..."</code> syntax, effect system, and LLM compiler
  </p>
</section>

<!-- Footer -->
<footer>
  <p>
    <a href="https://github.com/carlnoah6/ruby-mana">GitHub</a> ¬∑
    <a href="https://rubygems.org/gems/ruby-mana">RubyGems</a> ¬∑
    MIT License
  </p>
  <p style="margin-top:8px">Ruby 3.3+ ¬∑ Built with algebraic effects</p>
</footer>

</div>

<script>
(function() {
  const carousel = document.getElementById('heroCarousel');
  const slides = carousel.querySelectorAll('.slide');
  const dotsContainer = document.getElementById('carouselDots');
  let current = 0;
  let timer;

  // Create dots
  slides.forEach((_, i) => {
    const dot = document.createElement('span');
    dot.className = 'dot' + (i === 0 ? ' active' : '');
    dot.addEventListener('click', () => goTo(i));
    dotsContainer.appendChild(dot);
  });

  function goTo(index) {
    slides[current].classList.remove('active');
    dotsContainer.children[current].classList.remove('active');
    current = index;
    slides[current].classList.add('active');
    dotsContainer.children[current].classList.add('active');
    resetTimer();
  }

  function next() { goTo((current + 1) % slides.length); }
  function prev() { goTo((current - 1 + slides.length) % slides.length); }
  function resetTimer() { clearInterval(timer); timer = setInterval(next, 5000); }
  resetTimer();

  // Touch swipe
  let startX = 0;
  carousel.addEventListener('touchstart', function(e) { startX = e.touches[0].clientX; }, {passive: true});
  carousel.addEventListener('touchend', function(e) {
    const diff = startX - e.changedTouches[0].clientX;
    if (Math.abs(diff) > 50) { diff > 0 ? next() : prev(); }
  }, {passive: true});
})();
</script>

</body>
</html>
